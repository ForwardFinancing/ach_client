<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>
  Class: AchClient::ICheckGateway::AchTransaction
  
    &mdash; Documentation by YARD 0.9.25
  
</title>

  <link rel="stylesheet" href="../../css/style.css" type="text/css" />

  <link rel="stylesheet" href="../../css/common.css" type="text/css" />

<script type="text/javascript">
  pathId = "AchClient::ICheckGateway::AchTransaction";
  relpath = '../../';
</script>


  <script type="text/javascript" charset="utf-8" src="../../js/jquery.js"></script>

  <script type="text/javascript" charset="utf-8" src="../../js/app.js"></script>


  </head>
  <body>
    <div class="nav_wrap">
      <iframe id="nav" src="../../class_list.html?1"></iframe>
      <div id="resizer"></div>
    </div>

    <div id="main" tabindex="-1">
      <div id="header">
        <div id="menu">
  
    <a href="../../_index.html">Index (A)</a> &raquo;
    <span class='title'><span class='object_link'><a href="../../AchClient.html" title="AchClient (module)">AchClient</a></span></span> &raquo; <span class='title'><span class='object_link'><a href="../ICheckGateway.html" title="AchClient::ICheckGateway (class)">ICheckGateway</a></span></span>
     &raquo; 
    <span class="title">AchTransaction</span>
  
</div>

        <div id="search">
  
    <a class="full_list_link" id="class_list_link"
        href="../../class_list.html">

        <svg width="24" height="24">
          <rect x="0" y="4" width="24" height="4" rx="1" ry="1"></rect>
          <rect x="0" y="12" width="24" height="4" rx="1" ry="1"></rect>
          <rect x="0" y="20" width="24" height="4" rx="1" ry="1"></rect>
        </svg>
    </a>
  
</div>
        <div class="clear"></div>
      </div>

      <div id="content"><h1>Class: AchClient::ICheckGateway::AchTransaction
  
  
  
</h1>
<div class="box_info">
  
  <dl>
    <dt>Inherits:</dt>
    <dd>
      <span class="inheritName"><span class='object_link'><a href="../Abstract/AchTransaction.html" title="AchClient::Abstract::AchTransaction (class)">Abstract::AchTransaction</a></span></span>
      
        <ul class="fullTree">
          <li>Object</li>
          
            <li class="next"><span class='object_link'><a href="../Abstract/AchTransaction.html" title="AchClient::Abstract::AchTransaction (class)">Abstract::AchTransaction</a></span></li>
          
            <li class="next">AchClient::ICheckGateway::AchTransaction</li>
          
        </ul>
        <a href="#" class="inheritanceTree">show all</a>
      
    </dd>
  </dl>
  

  
  
  
  
  

  

  
  <dl>
    <dt>Defined in:</dt>
    <dd>lib/ach_client/providers/soap/i_check_gateway/ach_transaction.rb</dd>
  </dl>
  
</div>

<h2>Overview</h2><div class="docstring">
  <div class="discussion">
    
<p>ICheckGateway implementation for AchTransaction</p>


  </div>
</div>
<div class="tags">
  

</div>
  
    <h2>
      Constant Summary
      <small><a href="#" class="constants_summary_toggle">collapse</a></small>
    </h2>

    <dl class="constants">
      
        <dt id="NOC_RESPONSE_MATCHER-constant" class="">NOC_RESPONSE_MATCHER =
          <div class="docstring">
  <div class="discussion">
    
<p>When ICheck API gives us an error response containing a correction, the
response field looks like this:</p>

<pre class="code ruby"><code class="ruby">DECLINED - Notice of Change (XXX - Change Data: YYYYYY)
  Where X is a three character string representing the return code (example: C01)
  Where Y is any number of digits representing the updated information for the correction - the
    ACH attribute that should be updated (example: 123456789)
</code></pre>

<p>The (w3) capture group matches the return code, while the (d+) capture
group matches the correction data</p>

<pre class="code ruby"><code class="ruby">for later use.
</code></pre>


  </div>
</div>
<div class="tags">
  

</div>
        </dt>
        <dd><pre class="code"><span class='tstring'><span class='regexp_beg'>/</span><span class='tstring_content'>DECLINED - Notice of Change \((\w{3}) - Change Data: (\d+)\)</span><span class='regexp_end'>/</span></span></pre></dd>
      
    </dl>
  







  
    <h2>
      Instance Method Summary
      <small><a href="#" class="summary_toggle">collapse</a></small>
    </h2>

    <ul class="summary">
      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#do_send-instance_method" title="#do_send (instance method)">#<strong>do_send</strong>  &#x21d2; String </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'>
<p>Sends this transaction to ICheckGateway If successful, returns a string
from the response that seems to be a unique identifier for the transaction
from ICheckGateway Raises an exception with as much info as possible if
something goes wrong.</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#to_hash-instance_method" title="#to_hash (instance method)">#<strong>to_hash</strong>  &#x21d2; Hash </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'>
<p>Turns this transaction into a Hash that can be sent via soap to the
provider.</p>
</div></span>
  
</li>

      
    </ul>
  


  
  
  
  
  
  
  
  
  <h3 class="inherited">Methods inherited from <span class='object_link'><a href="../Abstract/AchTransaction.html" title="AchClient::Abstract::AchTransaction (class)">Abstract::AchTransaction</a></span></h3>
  <p class="inherited"><span class='object_link'><a href="../Abstract/AchTransaction.html#arguments-class_method" title="AchClient::Abstract::AchTransaction.arguments (method)">arguments</a></span>, <span class='object_link'><a href="../Abstract/AchTransaction.html#credit%3F-instance_method" title="AchClient::Abstract::AchTransaction#credit? (method)">#credit?</a></span>, <span class='object_link'><a href="../Abstract/AchTransaction.html#debit%3F-instance_method" title="AchClient::Abstract::AchTransaction#debit? (method)">#debit?</a></span>, <span class='object_link'><a href="../Abstract/AchTransaction.html#initialize-instance_method" title="AchClient::Abstract::AchTransaction#initialize (method)">#initialize</a></span>, <span class='object_link'><a href="../Abstract/AchTransaction.html#send-instance_method" title="AchClient::Abstract::AchTransaction#send (method)">#send</a></span>, <span class='object_link'><a href="../Abstract/AchTransaction.html#sendable%3F-instance_method" title="AchClient::Abstract::AchTransaction#sendable? (method)">#sendable?</a></span></p>
<div id="constructor_details" class="method_details_list">
  <h2>Constructor Details</h2>
  
    <p class="notice">This class inherits a constructor from <span class='object_link'><a href="../Abstract/AchTransaction.html#initialize-instance_method" title="AchClient::Abstract::AchTransaction#initialize (method)">AchClient::Abstract::AchTransaction</a></span></p>
  
</div>


  <div id="instance_method_details" class="method_details_list">
    <h2>Instance Method Details</h2>

    
      <div class="method_details first">
  <h3 class="signature first" id="do_send-instance_method">
  
    #<strong>do_send</strong>  &#x21d2; <tt>String</tt> 
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    
<p>Sends this transaction to ICheckGateway If successful, returns a string
from the response that seems to be a unique identifier for the transaction
from ICheckGateway Raises an exception with as much info as possible if
something goes wrong. ICheck sometimes returns an API error for certain
rejection scenarios. In this case we raise a</p>

<pre class="code ruby"><code class="ruby">InstantRejectionError which can be caught to handle any business logic appropriate for this edge case.
The exception contains a method ach_response that returns the information about the return.
</code></pre>


  </div>
</div>
<div class="tags">
  
<p class="tag_title">Returns:</p>
<ul class="return">
  
    <li>
      
      
        <span class='type'>(<tt>String</tt>)</span>
      
      
      
        &mdash;
        <div class='inline'>
<p>a string returned by ICheckGateway - external_ach_id</p>
</div>
      
    </li>
  
</ul>

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
47
48
49
50
51
52
53
54</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'lib/ach_client/providers/soap/i_check_gateway/ach_transaction.rb', line 24</span>

<span class='kw'>def</span> <span class='id identifier rubyid_do_send'>do_send</span>
  <span class='comment'># The response comes back as a | separated list of field values with
</span>  <span class='comment'>#   no header field/keys. It seems that the first column will contain
</span>  <span class='comment'>#   &#39;APPROVED&#39; if the request was successful. The 8th column is the
</span>  <span class='comment'>#   confirmation number
</span>  <span class='id identifier rubyid_response'>response</span> <span class='op'>=</span> <span class='const'><span class='object_link'><a href="../../AchClient.html" title="AchClient (module)">AchClient</a></span></span><span class='op'>::</span><span class='const'><span class='object_link'><a href="../ICheckGateway.html" title="AchClient::ICheckGateway (class)">ICheckGateway</a></span></span><span class='period'>.</span><span class='id identifier rubyid_wrap_request'><span class='object_link'><a href="../ICheckGateway.html#wrap_request-class_method" title="AchClient::ICheckGateway.wrap_request (method)">wrap_request</a></span></span><span class='lparen'>(</span>
    <span class='label'>method:</span> <span class='symbol'>:process_check</span><span class='comma'>,</span>
    <span class='label'>message:</span> <span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_to_hash'>to_hash</span>
  <span class='rparen'>)</span><span class='period'>.</span><span class='id identifier rubyid_split'>split</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>|</span><span class='tstring_end'>&#39;</span></span><span class='rparen'>)</span>
  <span class='kw'>if</span> <span class='id identifier rubyid_response'>response</span><span class='lbracket'>[</span><span class='int'>0</span><span class='rbracket'>]</span> <span class='op'>==</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>APPROVED</span><span class='tstring_end'>&#39;</span></span>
    <span class='comment'># Return the confirmation number
</span>    <span class='id identifier rubyid_response'>response</span><span class='lbracket'>[</span><span class='int'>7</span><span class='rbracket'>]</span>
  <span class='kw'>elsif</span> <span class='id identifier rubyid_response'>response</span><span class='lbracket'>[</span><span class='int'>0</span><span class='rbracket'>]</span><span class='period'>.</span><span class='id identifier rubyid_include?'>include?</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>DECLINED - Notice of Change</span><span class='tstring_end'>&#39;</span></span><span class='rparen'>)</span>
    <span class='id identifier rubyid_return_code'>return_code</span><span class='comma'>,</span> <span class='id identifier rubyid_addendum'>addendum</span> <span class='op'>=</span> <span class='const'><span class='object_link'><a href="#NOC_RESPONSE_MATCHER-constant" title="AchClient::ICheckGateway::AchTransaction::NOC_RESPONSE_MATCHER (constant)">NOC_RESPONSE_MATCHER</a></span></span><span class='period'>.</span><span class='id identifier rubyid_match'>match</span><span class='lparen'>(</span><span class='id identifier rubyid_response'>response</span><span class='lbracket'>[</span><span class='int'>0</span><span class='rbracket'>]</span><span class='rparen'>)</span><span class='period'>.</span><span class='id identifier rubyid_captures'>captures</span>
    <span class='comment'># The API error message incorrectly uses the normal correction return codes when the internal correction
</span>    <span class='comment'>#  return codes should be used instead (since the transaction is never forwarded through to the NACHA system)
</span>    <span class='comment'># Correcting this involves replacing `C0` with `XZ` (ie C01 becomes XZ1)
</span>    <span class='id identifier rubyid_corrected_return_code'>corrected_return_code</span> <span class='op'>=</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>XZ</span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_return_code'>return_code</span><span class='period'>.</span><span class='id identifier rubyid_last'>last</span><span class='embexpr_end'>}</span><span class='tstring_end'>&quot;</span></span>
    <span class='id identifier rubyid_raise'>raise</span> <span class='const'><span class='object_link'><a href="../ICheckGateway.html" title="AchClient::ICheckGateway (class)">ICheckGateway</a></span></span><span class='op'>::</span><span class='const'><span class='object_link'><a href="InstantRejectionError.html" title="AchClient::ICheckGateway::InstantRejectionError (class)">InstantRejectionError</a></span></span><span class='period'>.</span><span class='id identifier rubyid_new'><span class='object_link'><a href="InstantRejectionError.html#initialize-instance_method" title="AchClient::ICheckGateway::InstantRejectionError#initialize (method)">new</a></span></span><span class='lparen'>(</span>
      <span class='label'>nacha_return_code:</span> <span class='id identifier rubyid_corrected_return_code'>corrected_return_code</span><span class='comma'>,</span>
      <span class='label'>addendum:</span> <span class='id identifier rubyid_addendum'>addendum</span><span class='comma'>,</span>
      <span class='label'>transaction:</span> <span class='kw'>self</span>
    <span class='rparen'>)</span><span class='comma'>,</span> <span class='id identifier rubyid_response'>response</span><span class='lbracket'>[</span><span class='int'>0</span><span class='rbracket'>]</span>
  <span class='kw'>elsif</span> <span class='id identifier rubyid_response'>response</span><span class='lbracket'>[</span><span class='int'>0</span><span class='rbracket'>]</span><span class='period'>.</span><span class='id identifier rubyid_include?'>include?</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>DECLINED - Invalid Routing Number</span><span class='tstring_end'>&#39;</span></span><span class='rparen'>)</span>
    <span class='id identifier rubyid_raise'>raise</span> <span class='const'><span class='object_link'><a href="../ICheckGateway.html" title="AchClient::ICheckGateway (class)">ICheckGateway</a></span></span><span class='op'>::</span><span class='const'><span class='object_link'><a href="InstantRejectionError.html" title="AchClient::ICheckGateway::InstantRejectionError (class)">InstantRejectionError</a></span></span><span class='period'>.</span><span class='id identifier rubyid_new'><span class='object_link'><a href="InstantRejectionError.html#initialize-instance_method" title="AchClient::ICheckGateway::InstantRejectionError#initialize (method)">new</a></span></span><span class='lparen'>(</span><span class='label'>nacha_return_code:</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>X13</span><span class='tstring_end'>&#39;</span></span><span class='comma'>,</span> <span class='label'>transaction:</span> <span class='kw'>self</span><span class='rparen'>)</span><span class='comma'>,</span> <span class='id identifier rubyid_response'>response</span><span class='lbracket'>[</span><span class='int'>0</span><span class='rbracket'>]</span>
  <span class='kw'>else</span>
    <span class='comment'># Don&#39;t have a reliable way of getting the error message, so we will
</span>    <span class='comment'># just raise the whole response.
</span>    <span class='id identifier rubyid_raise'>raise</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>ICheckGateway ACH Transaction Failure: </span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_response'>response</span><span class='period'>.</span><span class='id identifier rubyid_join'>join</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>|</span><span class='tstring_end'>&#39;</span></span><span class='rparen'>)</span><span class='embexpr_end'>}</span><span class='tstring_end'>&quot;</span></span>
  <span class='kw'>end</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="to_hash-instance_method">
  
    #<strong>to_hash</strong>  &#x21d2; <tt>Hash</tt> 
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    
<p>Turns this transaction into a Hash that can be sent via soap to the
provider</p>


  </div>
</div>
<div class="tags">
  
<p class="tag_title">Returns:</p>
<ul class="return">
  
    <li>
      
      
        <span class='type'>(<tt>Hash</tt>)</span>
      
      
      
        &mdash;
        <div class='inline'>
<p>payload for ICheckGateway</p>
</div>
      
    </li>
  
</ul>

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


59
60
61
62
63
64
65
66
67
68
69
70
71
72
73
74
75</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'lib/ach_client/providers/soap/i_check_gateway/ach_transaction.rb', line 59</span>

<span class='kw'>def</span> <span class='id identifier rubyid_to_hash'>to_hash</span>
  <span class='const'><span class='object_link'><a href="../../AchClient.html" title="AchClient (module)">AchClient</a></span></span><span class='op'>::</span><span class='const'><span class='object_link'><a href="../ICheckGateway.html" title="AchClient::ICheckGateway (class)">ICheckGateway</a></span></span><span class='op'>::</span><span class='const'><span class='object_link'><a href="CompanyInfo.html" title="AchClient::ICheckGateway::CompanyInfo (class)">CompanyInfo</a></span></span><span class='period'>.</span><span class='id identifier rubyid_build'><span class='object_link'><a href="CompanyInfo.html#build-class_method" title="AchClient::ICheckGateway::CompanyInfo.build (method)">build</a></span></span><span class='period'>.</span><span class='id identifier rubyid_to_hash'><span class='object_link'><a href="CompanyInfo.html#to_hash-instance_method" title="AchClient::ICheckGateway::CompanyInfo#to_hash (method)">to_hash</a></span></span><span class='period'>.</span><span class='id identifier rubyid_merge'>merge</span><span class='lparen'>(</span><span class='lbrace'>{</span>
    <span class='label'>APIMethod:</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>ProcessCheck</span><span class='tstring_end'>&#39;</span></span><span class='comma'>,</span>
    <span class='label'>Amount:</span> <span class='id identifier rubyid_amount'>amount</span><span class='comma'>,</span>
    <span class='label'>RoutingNumber:</span> <span class='id identifier rubyid_routing_number'>routing_number</span><span class='period'>.</span><span class='id identifier rubyid_to_s'>to_s</span><span class='comma'>,</span>
    <span class='label'>AccountNumber:</span> <span class='id identifier rubyid_account_number'>account_number</span><span class='period'>.</span><span class='id identifier rubyid_to_s'>to_s</span><span class='comma'>,</span>
    <span class='label'>AccountType:</span> <span class='const'><span class='object_link'><a href="../../AchClient.html" title="AchClient (module)">AchClient</a></span></span><span class='op'>::</span><span class='const'><span class='object_link'><a href="../ICheckGateway.html" title="AchClient::ICheckGateway (class)">ICheckGateway</a></span></span><span class='op'>::</span><span class='const'><span class='object_link'><a href="AccountTypeTransformer.html" title="AchClient::ICheckGateway::AccountTypeTransformer (class)">AccountTypeTransformer</a></span></span>
                   <span class='period'>.</span><span class='id identifier rubyid_serialize_to_provider_value'>serialize_to_provider_value</span><span class='lparen'>(</span><span class='id identifier rubyid_account_type'>account_type</span><span class='rparen'>)</span><span class='comma'>,</span>
    <span class='label'>EntryClassCode:</span> <span class='id identifier rubyid_sec_code'>sec_code</span><span class='comma'>,</span>
    <span class='label'>TransactionType:</span>
      <span class='const'><span class='object_link'><a href="../../AchClient.html" title="AchClient (module)">AchClient</a></span></span><span class='op'>::</span><span class='const'><span class='object_link'><a href="../ICheckGateway.html" title="AchClient::ICheckGateway (class)">ICheckGateway</a></span></span><span class='op'>::</span><span class='const'><span class='object_link'><a href="TransactionTypeTransformer.html" title="AchClient::ICheckGateway::TransactionTypeTransformer (class)">TransactionTypeTransformer</a></span></span>
        <span class='period'>.</span><span class='id identifier rubyid_serialize_to_provider_value'>serialize_to_provider_value</span><span class='lparen'>(</span><span class='id identifier rubyid_transaction_type'>transaction_type</span><span class='rparen'>)</span><span class='comma'>,</span>
    <span class='label'>CompanyName:</span> <span class='id identifier rubyid_merchant_name'>merchant_name</span><span class='comma'>,</span>
    <span class='label'>Description:</span> <span class='id identifier rubyid_memo'>memo</span><span class='comma'>,</span>
    <span class='label'>TransactionDate:</span> <span class='id identifier rubyid_effective_entry_date'>effective_entry_date</span>
  <span class='rbrace'>}</span><span class='rparen'>)</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
  </div>

</div>

      <div id="footer">
  Generated on Tue May 12 10:48:48 2020 by
  <a href="http://yardoc.org" title="Yay! A Ruby Documentation Tool" target="_parent">yard</a>
  0.9.25 (ruby-2.5.0).
</div>

    </div>
  </body>
</html>